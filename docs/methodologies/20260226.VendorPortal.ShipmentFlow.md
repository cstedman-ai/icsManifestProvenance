# 20260226 — Vendor Portal — Shipment Flow

> Derived from: `docs/from.Coreweave/CoreWeave Logistics Packing List Requirements .md`
>
> Purpose: Define the functional flow and data requirements for the Vendor Portal so that vendor-submitted shipment manifests comply with CoreWeave's standard packing slip, packing list, commercial invoice, pallet identification, and labeling requirements.

---

## 1. Authentication & Vendor Identity

### 1.1 Vendor Login
- Vendor users select their company (Dell, SuperMicro, NVIDIA, Opengear) before entering credentials.
- The authenticated session carries the vendor identity throughout the portal so all submissions are automatically attributed to the correct vendor.

### 1.2 Scoped Access
- Vendor users may only view and act on Purchase Orders addressed to their company.
- All other platform modules (Dashboard, Receiving, Reconciliation, Data Management) are hidden.

---

## 2. Purchase Order Selection

### 2.1 Filtered PO List
- On entry, the portal displays only POs in `issued` or `shipped` status that match the logged-in vendor.
- Each PO row shows: **PO Number**, **Vendor Name**, **Status**, **Created Date**, and **Line-Item Count**.

### 2.2 Multi-PO Shipment Support
- A vendor may select **one or more POs** to include in a single shipment.
- This satisfies the CoreWeave requirement that packing slips covering multiple POs must "clearly list each PO number and group all line items under the corresponding PO."

---

## 3. Shipment-Level Information

Once PO(s) are selected, the vendor completes a shipment-level form:

### 3.1 Required Fields
| Field | Source / Notes |
|---|---|
| **Carrier / Tracking Number** | Free text; vendor enters the carrier tracking number assigned at pickup. |
| **Shipment Type** | Domestic / International — toggles commercial invoice section. |
| **Incoterms + Place** | Required for international shipments (e.g., "DAP Schertz, TX, USA – Incoterms 2020"). |
| **Shipment Notes** | Optional free-text for any supplementary shipping notes. |

### 3.2 Pallet Registration (Multi-Pallet Shipments)
Per CoreWeave Section 4.2:
- If the shipment includes **more than one pallet**, the vendor must register each pallet:
  - **Pallet ID** — unique alphanumeric identifier within the shipment.
  - **Pallet Type** — single-SKU or mixed-SKU.
- Pallet IDs are then available for assignment during line-item entry.

---

## 4. Line-Item Entry

For each PO line item being shipped, the vendor provides:

### 4.1 Core Fields (Per CoreWeave Section 1.2)
| Field | Requirement |
|---|---|
| **CoreWeave Friendly SKU** | Pre-populated from the PO; read-only. Must match the PO exactly. |
| **Manufacturer's Part Number (MPN)** | Pre-populated from PO if available; editable. If none, display "N/A". |
| **Quantity Shipped** | Numeric input; defaults to quantity ordered. Vendor adjusts for partial shipments. |
| **Serial Numbers** | Entry field for each serial number associated with this SKU. Serials can be entered one-by-one, pasted as a list, or (for single-SKU pallets) assigned at the pallet level via 2D barcode. |

### 4.2 Pallet Assignment
- Each line item (or group of serials) may be assigned to a **Pallet ID** registered in Step 3.2.
- For **single-SKU pallets**, serial numbers entered for that line item + pallet combination will be encoded into the generated 2D barcode (Section 6).

### 4.3 Validation Rules
- Quantity Shipped must be > 0 and ≤ Quantity Ordered.
- Serial number count must match Quantity Shipped (for serialized SKUs).
- Serial numbers must be unique across the entire shipment.
- Every serial must be assigned to a Pallet ID if the shipment is multi-pallet.

---

## 5. Packed Dimensions & Weight (Packing List Data)

Per CoreWeave Section 2, the vendor provides physical shipping measurements:

### 5.1 Per Packed Unit
For each carton, crate, or pallet as tendered to the carrier:

| Field | Format |
|---|---|
| **Packed Unit Label** | Identifier (e.g., "Pallet A", "Carton 1"). Maps to Pallet ID where applicable. |
| **Length × Width × Height** | Numeric, with unit selector (inches / cm). |
| **Weight** | Numeric, with unit selector (lbs / kg). |
| **Contents Summary** | Auto-generated: lists SKUs and quantities assigned to this packed unit. |

### 5.2 Validation
- Dimensions and weight are required for every packed unit.
- All measurements must reflect the item **as shipped** — including boxes, foams, pallets, outer containers.
- If multiple distinct pack configurations exist, each must have its own entry.

---

## 6. Commercial Invoice (International Shipments Only)

If **Shipment Type = International** (per CoreWeave Section 3):

### 6.1 Header Fields
| Field | Notes |
|---|---|
| **Exporter / Shipper** | Pre-populated from vendor profile (name, address, contact). Editable. |
| **Consignee** | Pre-populated: CoreWeave legal entity + delivery address from PO. |
| **Invoice Number** | Vendor-assigned. |
| **Invoice Date** | Defaults to today; editable. |
| **Currency** | Selector (USD, EUR, GBP, etc.). |
| **Incoterms + Place** | Carried forward from shipment-level entry. |
| **Reason for Export** | Selector: Sale, Return for Repair, RMA – No Commercial Value, Warranty Replacement – No Charge. |

### 6.2 Line-Item Fields (per product)
| Field | Notes |
|---|---|
| **CoreWeave Friendly SKU** | From PO. |
| **MPN** | From line-item entry. |
| **Description of Goods** | Plain-language commercial description. |
| **HS / Tariff Code** | Minimum 6-digit. |
| **Country of Origin** | Per item. |
| **Quantity & Unit of Measure** | From line-item entry. |
| **Unit Price** | From PO or vendor-entered. |
| **Extended Line Value** | Auto-calculated: Quantity × Unit Price. |

### 6.3 Totals
- Subtotal, Freight/Insurance (if charged), and Grand Total are auto-calculated.
- All values must match the packing slip and packing list; the system flags mismatches before submission.

---

## 7. Review & Submission

### 7.1 Pre-Submission Review Screen
Before final submission, the vendor sees a consolidated view:

1. **Shipment Summary** — Carrier, tracking, type, incoterms (if intl).
2. **PO Line Items** — Grouped by PO Number, showing SKU, MPN, qty shipped, serials, pallet assignment.
3. **Packed Dimensions & Weight** — Table of all packed units with measurements.
4. **Commercial Invoice** (if international) — Full invoice preview.
5. **Validation Status** — Green checkmarks or red warnings per section.

### 7.2 Validation Gate
The system blocks submission if any of the following are unresolved:
- Missing mandatory fields (SKU, qty, serials for serialized items, dimensions/weight).
- Serial count ≠ quantity shipped for serialized SKUs.
- Duplicate serial numbers.
- Pallet IDs referenced in line items but not registered.
- Dimension/weight entries missing for any packed unit.
- (International) Commercial invoice line values ≠ packing list values.

### 7.3 Submission
- On successful validation, the shipment manifest is saved and the PO status transitions to `shipped`.
- The system generates:
  - A **printable packing slip** (per Section 1 requirements).
  - A **printable packing list** with dimensions and weights.
  - **2D barcode labels** (QR Code) for each single-SKU pallet, encoding: Pallet ID, PO Number, SKU, MPN, quantity, and serial numbers.
  - A **commercial invoice PDF** (if international).

---

## 8. Post-Submission Outputs

### 8.1 QR / 2D Barcode Generation
Per CoreWeave Section 4.3, for each single-SKU pallet the system generates a QR code encoding:
- Pallet ID
- CoreWeave PO Number
- CoreWeave Friendly SKU
- MPN (or "N/A")
- Quantity on pallet
- All serial numbers for units on that pallet

The QR code is displayed on-screen and available for print. The human-readable label alongside includes: Pallet ID, PO Number, SKU, and quantity.

### 8.2 Unit / Carton Barcode Labels
Per CoreWeave Section 5, the system also generates individual unit/carton labels containing:
- CoreWeave PO Number
- CoreWeave Friendly SKU
- MPN (or "N/A")
- Serial Number (human-readable + Code 128 barcode)

### 8.3 Document Downloads
The vendor can download / print:
- Packing Slip (PDF)
- Packing List with Dimensions & Weights (PDF)
- Pallet QR Labels (printable, designed for two-sided placement)
- Unit/Carton Serial Barcode Labels
- Commercial Invoice (PDF, international only)

### 8.4 Confirmation & Audit Trail
- The portal shows a confirmation screen with shipment ID, PO numbers covered, and timestamp.
- All submitted data is immutable post-submission to preserve the audit trail for reconciliation.

---

## 9. Flow Diagram (Summary)

```
┌─────────────┐
│  Vendor      │
│  Login       │
│  (company +  │
│  credentials)│
└──────┬───────┘
       │
       ▼
┌─────────────┐     ┌──────────────────┐
│ Select PO(s)│────▶│ Shipment-Level   │
│ (filtered   │     │ Info (carrier,   │
│  by vendor) │     │ type, pallets)   │
└─────────────┘     └────────┬─────────┘
                             │
                ┌────────────┼──────────────┐
                ▼            ▼              ▼
         ┌───────────┐ ┌──────────┐ ┌─────────────┐
         │ Line-Item │ │ Packed   │ │ Commercial  │
         │ Entry     │ │ Dims &   │ │ Invoice     │
         │ (SKU, qty,│ │ Weight   │ │ (intl only) │
         │ serials,  │ │          │ │             │
         │ pallet)   │ │          │ │             │
         └─────┬─────┘ └────┬─────┘ └──────┬──────┘
               │             │              │
               └─────────────┼──────────────┘
                             ▼
                    ┌─────────────────┐
                    │ Review &        │
                    │ Validation      │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │ Submit          │
                    │ ─ Save manifest │
                    │ ─ PO → shipped  │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │ Outputs:        │
                    │ ─ Packing Slip  │
                    │ ─ Packing List  │
                    │ ─ QR Labels     │
                    │ ─ Barcode Labels│
                    │ ─ Invoice (intl)│
                    └─────────────────┘
```

---

## 10. Implementation Notes

### 10.1 Data Model Changes
- **Shipment** needs new fields: `shipmentType` (domestic/international), `incoterms`, `pallets[]` (id, type, skuId, serials), `packedUnits[]` (label, dims, weight, contents).
- **Shipment Line Item** needs: `palletId`, `mpn`.
- New entity: **CommercialInvoice** linked to Shipment, with header fields and line items.

### 10.2 Vendor-Scoped PO Filtering
- The `AppContext` or a derived query must filter POs by the vendor name matching `user.vendor.name` or `user.vendor.shortName`.

### 10.3 Barcode Generation
- Existing `qrcode.react` covers QR/2D barcodes for pallet labels.
- Unit/carton serial barcode labels (Code 128) will require an additional library (e.g., `jsbarcode` or `react-barcode`).

### 10.4 PDF Generation
- Packing slip, packing list, and commercial invoice PDFs can be generated client-side (e.g., `jspdf` + `jspdf-autotable`) or via a print stylesheet for `window.print()`.
